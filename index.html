<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CDA Demo — Panel interactivo</title>

  <!-- Bootstrap + FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{--accent:#00b7d9;--dark:#002D72}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:#f4f6f9}
    .navbar{background:linear-gradient(90deg,var(--dark),#003b8a)}
    .brand{color:white;font-weight:700}
    .container-main{padding:28px}
    .card-action{cursor:pointer;transition:all .18s ease}
    .card-action:hover{transform:translateY(-6px);box-shadow:0 10px 24px rgba(0,0,0,0.08)}
    .sidebar{min-width:260px;background:var(--dark);color:#fff;height:100vh;padding:20px;position:fixed}
    .sidebar .profile-img{width:84px;height:84px;border-radius:50%;object-fit:cover;border:3px solid var(--accent)}
    .menu a{color:#e6eef6;text-decoration:none;display:flex;align-items:center;padding:10px;border-radius:8px}
    .menu a:hover, .menu a.active{background:var(--accent);color:#002D72;font-weight:600}
    .content{margin-left:280px;padding:26px}
    .btn-primary{background:var(--accent);border:none}
    .badge-urgent{background:#ff6b6b;color:white}
    .small-muted{color:#6b7280;font-size:.95rem}
    .vehicle-row:hover{background:#f8fafc}
    /* responsive */
    @media(max-width:990px){
      .sidebar{display:none}
      .content{margin-left:0;padding:12px}
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid px-4">
    <span class="brand">CDA — Demo</span>
    <div class="ms-auto d-flex align-items-center">
      <button id="btn-login-open" class="btn btn-outline-light me-2"><i class="fa fa-right-to-bracket"></i> Ingresar</button>
      <button id="btn-register-open" class="btn btn-light"><i class="fa fa-user-plus"></i> Registrarse</button>
    </div>
  </div>
</nav>

<!-- LAYOUT -->
<div class="d-flex">
  <!-- SIDEBAR -->
  <aside class="sidebar d-none d-lg-block">
    <div class="text-center mb-3">
      <img id="profilePicSidebar" src="https://i.pravatar.cc/84" class="profile-img mb-2" alt="foto">
      <div id="sidebarName" style="font-weight:600">Visitante</div>
      <div id="sidebarId" class="small-muted">No conectado</div>
    </div>

    <nav class="menu">
      <a href="#" class="d-flex align-items-center mb-2 active" data-view="dashboard"><i class="fa fa-house fa-fw me-2"></i> <span>Inicio</span></a>
      <a href="#" class="d-flex align-items-center mb-2" data-view="vehiculos"><i class="fa fa-car-side fa-fw me-2"></i> <span>Mis Vehículos</span></a>
      <a href="#" class="d-flex align-items-center mb-2" data-view="citas"><i class="fa fa-calendar-check fa-fw me-2"></i> <span>Agenda</span></a>
      <a href="#" class="d-flex align-items-center mb-2" data-view="notificaciones"><i class="fa fa-bell fa-fw me-2"></i> <span>Notificaciones</span></a>
      <a href="#" class="d-flex align-items-center mb-2" data-view="chat"><i class="fa fa-comments fa-fw me-2"></i> <span>Chatbot</span></a>
      <a href="#" class="d-flex align-items-center mb-2" data-view="perfil"><i class="fa fa-user fa-fw me-2"></i> <span>Perfil</span></a>
      <a href="#" class="d-flex align-items-center text-danger mt-3" id="logoutBtn"><i class="fa fa-sign-out-alt fa-fw me-2"></i> <span>Cerrar sesión</span></a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="content container-main" id="mainContent">

    <!-- DASHBOARD VIEW -->
    <div id="view-dashboard" class="view">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Panel</h3>
        <div id="userControls" style="min-width:220px"></div>
      </div>

      <div class="row g-3">
        <div class="col-md-4">
          <div class="card p-3 card-action" onclick="navigate('vehiculos')">
            <div class="d-flex align-items-center">
              <div class="me-3"><i class="fa fa-car fa-2x" style="color:var(--dark)"></i></div>
              <div>
                <div style="font-weight:700">Mis Vehículos</div>
                <div class="small-muted" id="countVehicles">0 registrados</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-3 card-action" onclick="navigate('citas')">
            <div class="d-flex align-items-center">
              <div class="me-3"><i class="fa fa-calendar-check fa-2x" style="color:var(--dark)"></i></div>
              <div>
                <div style="font-weight:700">Citas</div>
                <div class="small-muted" id="countAppointments">0 programadas</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-3 card-action" onclick="navigate('notificaciones')">
            <div class="d-flex align-items-center">
              <div class="me-3"><i class="fa fa-bell fa-2x" style="color:var(--dark)"></i></div>
              <div>
                <div style="font-weight:700">Notificaciones</div>
                <div class="small-muted" id="countNotifications">0 alertas</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <div class="row">
        <div class="col-lg-8">
          <h5>Resumen rápido</h5>
          <div id="quickList" class="list-group mt-2"></div>
        </div>

        <div class="col-lg-4">
          <h5>Acciones rápidas</h5>
          <div class="d-grid gap-2 mt-2">
            <button class="btn btn-primary" onclick="openAddVehicleModal()"><i class="fa fa-plus me-2"></i>Agregar vehículo</button>
            <button class="btn btn-outline-secondary" onclick="openAppointmentModal()"><i class="fa fa-calendar-plus me-2"></i>Agendar cita</button>
            <button class="btn btn-outline-secondary" onclick="notifyCheckExpirations()"><i class="fa fa-bell me-2"></i>Revisar vencimientos</button>
          </div>
        </div>
      </div>
    </div>

    <!-- VEHÍCULOS VIEW -->
    <div id="view-vehiculos" class="view d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Mis Vehículos</h3>
        <div>
          <button class="btn btn-primary" onclick="openAddVehicleModal()"><i class="fa fa-plus me-1"></i> Nuevo vehículo</button>
        </div>
      </div>

      <div class="card p-3">
        <div id="vehiclesTableContainer"></div>
      </div>
    </div>

    <!-- CITAS VIEW -->
    <div id="view-citas" class="view d-none">
      <div class="d-flex justify-content-between">
        <h3>Agenda de citas</h3>
        <div>
          <button class="btn btn-primary" onclick="openAppointmentModal()"><i class="fa fa-calendar-plus me-1"></i> Agendar nueva</button>
        </div>
      </div>
      <div class="card p-3 mt-3">
        <div id="appointmentsList"></div>
      </div>
    </div>

    <!-- NOTIFICACIONES VIEW -->
    <div id="view-notificaciones" class="view d-none">
      <h3>Notificaciones</h3>
      <div class="card p-3 mt-3">
        <div id="notificationsList"></div>
      </div>
    </div>

    <!-- CHAT VIEW -->
    <div id="view-chat" class="view d-none">
      <h3>Asistente virtual</h3>
      <div class="card p-3 mt-3">
        <div id="chatWindow" style="height:320px; overflow:auto; padding:8px; border-radius:8px; background:#fcfdff"></div>
        <div class="d-flex mt-3">
          <input id="chatInput" class="form-control me-2" placeholder="Escribe: 'agendar cita', '¿cuándo vence ABC123?'">
          <button class="btn btn-primary" onclick="sendChat()">Enviar</button>
        </div>
      </div>
    </div>

    <!-- PERFIL VIEW -->
    <div id="view-perfil" class="view d-none">
      <h3>Perfil</h3>
      <div class="card p-3 mt-3">
        <div class="row g-3">
          <div class="col-md-4 text-center">
            <img id="profilePreview" src="https://i.pravatar.cc/120" class="img-fluid rounded-circle mb-2" alt="foto">
            <input class="form-control" type="file" id="uploadPhoto" accept="image/*">
          </div>
          <div class="col-md-8">
            <label class="form-label">Nombre</label>
            <input id="perfilNombre" class="form-control mb-2">
            <label class="form-label">Documento (Cédula o NIT)</label>
            <input id="perfilId" class="form-control mb-2" disabled>
            <label class="form-label">Correo</label>
            <input id="perfilCorreo" class="form-control mb-2">
            <label class="form-label">Teléfono</label>
            <input id="perfilTelefono" class="form-control mb-2">
            <div class="d-flex gap-2 mt-2">
              <button class="btn btn-primary" onclick="saveProfile()">Guardar</button>
              <button class="btn btn-outline-secondary" onclick="logout()">Cerrar sesión</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- MODALS: Registro/Login/Vehículo/Cita -->
<!-- Register Modal -->
<div class="modal" id="modalRegister" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formRegister" class="modal-body">
        <h5>Crear cuenta</h5>
        <div class="mb-2">
          <label class="form-label">Tipo</label>
          <select id="regType" class="form-select">
            <option value="natural">Persona natural</option>
            <option value="empresa">Empresa</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Nombre</label>
          <input id="regName" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label" id="regDocLabel">Cédula</label>
          <input id="regDoc" class="form-control" required>
        </div>
        <div class="mb-2" id="regVehicleDiv">
          <label class="form-label">Placa inicial (se usará como contraseña)</label>
          <input id="regPlaca" class="form-control" placeholder="ABC123">
        </div>
        <div class="mb-2" id="regPassDiv" style="display:none">
          <label class="form-label">Contraseña (solo empresas)</label>
          <input id="regPass" type="password" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Correo</label>
          <input id="regEmail" type="email" class="form-control">
        </div>
        <div class="d-flex justify-content-end">
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Crear</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div class="modal" id="modalLogin" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formLogin" class="modal-body">
        <h5>Iniciar sesión</h5>
        <div class="mb-2">
          <label class="form-label">Documento (cédula o NIT)</label>
          <input id="loginDoc" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña</label>
          <input id="loginPass" type="password" class="form-control" required>
        </div>
        <div class="d-flex justify-content-end">
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Entrar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Vehicle Modal -->
<div class="modal" id="modalVehicle" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formVehicle" class="modal-body">
        <h5 id="vehicleModalTitle">Agregar vehículo</h5>
        <div class="mb-2"><label class="form-label">Placa</label><input id="vehPlaca" class="form-control" required></div>
        <div class="mb-2"><label class="form-label">Marca</label><input id="vehMarca" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Modelo</label><input id="vehModelo" class="
